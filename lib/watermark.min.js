!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WaterMark=e()}(this,function(){"use strict";return class{constructor(t){this.options={...this.options,...t}}options={name:"2080code-watermark",carrierElem:document.body,mode:"mat",zIndex:1e5,content:"watermark",fontWeight:"normal",fontSize:"16px",fontFamily:"Hei",fontColor:"rgba(0,0,0,1)",baseline:"before-edge",rotateDegree:0,size:"auto",margin:0,padding:0,opacity:.1,needClip:!0,tuning:!1,degraded:!1,position:"center center",repeat:"repeat"};draw(t){const{content:e,fontWeight:n,fontSize:o,fontFamily:i,fontColor:a,baseline:s,rotateDegree:r,margin:l,padding:c,opacity:d,needClip:h,tuning:u,degraded:g}={...this.options,...t},p=[n,o,i].join(" "),m=this;this.svgGenerate(function(){const t=document.createElement("canvas"),f=t.getContext("2d");function x(t){return f.font=p,f.fillStyle="red",f.textAlign="start",f.textBaseline="top",f.measureText(t)}let b=null;b=g?function(t){const e=document.createElement("span");e.style.display="inline-block",e.style.fontWeight=n,e.style.fontSize=o,e.style.fontFamily=i,e.innerText=t,e.style.visibility="hidden",document.body.appendChild(e);const a=window.getComputedStyle(e),s=JSON.parse(JSON.stringify({actualBoundingBoxRight:parseFloat(a.width),actualBoundingBoxDescent:parseFloat(a.height),actualBoundingBoxLeft:0,actualBoundingBoxAscent:0}));return document.body.removeChild(e),s}(e):x(e);const y=b.actualBoundingBoxRight+b.actualBoundingBoxLeft,B=b.actualBoundingBoxDescent+b.actualBoundingBoxAscent,w=Math.sqrt(Math.pow(y/2,2)+Math.pow(B/2,2))+c,P=w-y/2,M=w-B/2,v=-w+P+b.actualBoundingBoxLeft,k=-w+M+b.actualBoundingBoxAscent,A=[[-y/2,-B/2],[y/2,-B/2],[y/2,B/2],[-y/2,B/2]],C=r*Math.PI/180,D=A.map(t=>[t[0]*Math.cos(C)-t[1]*Math.sin(C),t[0]*Math.sin(C)+t[1]*Math.cos(C)]),S=[Math.min(...D.map(t=>t[0]))-c,Math.min(...D.map(t=>t[1]))-c],T=[Math.max(...D.map(t=>t[0]))+c,Math.max(...D.map(t=>t[1]))+c].map(t=>2*t);if(u&&(t.width=2*w+l,t.height=2*w+l,f.globalAlpha=d,f.translate(w,w),f.rotate(C),x(e),f.fillText(e,v,k),f.fillStyle="rgba(0,0,0,0.2)",f.beginPath(),f.strokeRect(-w+P,-w+M,y,B),f.closePath(),f.setLineDash([5,15]),f.beginPath(),f.moveTo(-w,0),f.lineTo(w,0),f.closePath(),f.stroke(),f.rotate(-C),f.setLineDash([]),f.beginPath(),f.arc(0,0,w-c,0,2*Math.PI),f.closePath(),f.stroke(),f.beginPath(),f.arc(0,0,w,0,2*Math.PI),f.closePath(),f.stroke(),D.forEach(t=>{f.fillStyle="red",f.beginPath(),f.arc(t[0],t[1],1.5,0,2*Math.PI),f.closePath(),f.fill()}),f.beginPath(),f.strokeRect(...S,...T),f.closePath()),h){let e=f.getImageData(...S,...T.map(t=>t+w));t.width=T[0]+l,t.height=T[1]+l,f.putImageData(e,...S.map(t=>t-(t+w)))}return u&&m.put(t.toDataURL("image/png"),!0),{content:e,rotateDegree:r,margin:l,width:t.width,height:t.height,contWidth:y,contHeight:B,txtProp:b,fontStyle:p,fontColor:a,baseline:s,opacity:d,tuning:u}}())}svgGenerate(t){let e="",{x:n,y:o}={x:(t.width-t.margin)/2-t.contWidth/2,y:(t.height-t.margin)/2-t.contHeight/2};const i=[t.rotateDegree,n+t.contWidth/2,o+t.contHeight/2].join(","),a=document.createElement("svg"),s=document.createElement("text");return a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("width",t.width),a.setAttribute("height",t.height),a.setAttribute("version","1.1"),s.innerText=t.content,s.style=[`font:${t.fontStyle}`,`fill:${t.fontColor}`,"text-anchor:start",`alignment-baseline:${t.baseline}`].join("; "),s.setAttribute("x",n+t.txtProp.actualBoundingBoxLeft),s.setAttribute("y",o+t.txtProp.actualBoundingBoxAscent),s.setAttribute("transform",`rotate(${i})`),s.setAttribute("opacity",t.opacity),a.append(s),e="data:image/svg+xml;base64,"+window.btoa(window.unescape(encodeURIComponent(a.outerHTML))),this.put(e),e}put(t,e){let n=this.options.name+(e?"-tuning":""),o=document.getElementById(n),i=null,a=this.options.carrierElem;"cover"===this.options.mode?(i=o||document.createElement("div"),i.id=n):i=a||document.body,i.style=[i.style.cssText,"-webkit-print-color-adjust:exact","print-color-adjust:exact","color-adjust:exact",`background-image:url(${t})`,`background-position:${this.options.position}`,`background-repeat:${this.options.repeat}`,`background-size:${this.options.size}`].join("!important;"),"cover"===this.options.mode&&(i.style=[i.style.cssText,"pointer-events:none","position:absolute",`z-index:${this.options.zIndex}`,"top:0","left:0","width:100%","height:100%"].join("!important;"),a.style.position="relative",o||a.append(i))}}});//# sourceMappingURL=watermark.min.js.map
