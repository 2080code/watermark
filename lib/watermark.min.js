!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WaterMark=e()}(this,function(){"use strict";return class{constructor(t){this.options={name:"2080code-watermark",mode:"mat",carrierElem:document.body,zIndex:1e5,content:"watermark",url:"",fontWeight:"normal",fontSize:"16px",fontFamily:"Hei",fontColor:"rgba(0,0,0,1)",baseline:"hanging",rotateDegree:0,size:"auto",margin:0,padding:0,position:"center center",repeat:"repeat",opacity:.1,needClip:!0,degraded:!1,tuning:!1},this.options=Object.assign(Object.assign({},this.options),t)}draw(t){const e=Object.assign(Object.assign({},this.options),t);if(!e.url&&!e.content)throw new Error("options.url or options.content is required");const n=this.draft(e),i=this.svgGenerate(n,e);this.put(i,e)}draft(t){const{content:e,fontWeight:n,fontSize:i,fontFamily:o,fontColor:a,baseline:r,rotateDegree:s,margin:l,padding:c,opacity:d,needClip:u,tuning:g,degraded:h}=t,p=[n,i,o].join(" "),m=document.createElement("canvas"),b=m.getContext("2d");function f(t){return b.font=p,b.fillStyle="red",b.textAlign="start",b.textBaseline="top",b.measureText(t)}let x=null;x=h?function(t){const e=document.createElement("span");e.style.display="inline-block",e.style.fontWeight=n,e.style.fontSize=i,e.style.fontFamily=o,e.innerText=t,e.style.visibility="hidden",document.body.appendChild(e);const a=window.getComputedStyle(e),r=JSON.parse(JSON.stringify({actualBoundingBoxRight:parseFloat(a.width),actualBoundingBoxDescent:parseFloat(a.height),actualBoundingBoxLeft:0,actualBoundingBoxAscent:0}));return document.body.removeChild(e),r}(e):f(e);const y=x.actualBoundingBoxRight+x.actualBoundingBoxLeft,w=x.actualBoundingBoxDescent+x.actualBoundingBoxAscent,A=Math.sqrt(Math.pow(y/2,2)+Math.pow(w/2,2))+c,B=A-y/2,$=A-w/2,v=-A+B+x.actualBoundingBoxLeft,P=-A+$+x.actualBoundingBoxAscent,k=[[-y/2,-w/2],[y/2,-w/2],[y/2,w/2],[-y/2,w/2]],M=(null!=s?s:0)*Math.PI/180,j=k.map(t=>[t[0]*Math.cos(M)-t[1]*Math.sin(M),t[0]*Math.sin(M)+t[1]*Math.cos(M)]),E=[Math.min(...j.map(t=>t[0]))-c,Math.min(...j.map(t=>t[1]))-c],S=[Math.max(...j.map(t=>t[0]))+c,Math.max(...j.map(t=>t[1]))+c].map(t=>2*t);if(g&&(m.width=2*A+l,m.height=2*A+l,b.globalAlpha=d,b.translate(A,A),b.rotate(M),f(e),b.fillText(e,v,P),b.fillStyle="rgba(0,0,0,0.2)",b.beginPath(),b.strokeRect(-A+B,-A+$,y,w),b.closePath(),b.setLineDash([5,15]),b.beginPath(),b.moveTo(-A,0),b.lineTo(A,0),b.closePath(),b.stroke(),b.rotate(-M),b.setLineDash([]),b.beginPath(),b.arc(0,0,A-c,0,2*Math.PI),b.closePath(),b.stroke(),b.beginPath(),b.arc(0,0,A,0,2*Math.PI),b.closePath(),b.stroke(),j.forEach(t=>{b.fillStyle="red",b.beginPath(),b.arc(t[0],t[1],0,0,2*Math.PI),b.closePath(),b.fill()}),b.beginPath(),b.strokeRect(...E,...S),b.closePath()),u){const t=b.getImageData(...E,...S.map(t=>t+A));m.width=S[0]+l,m.height=S[1]+l,b.putImageData(t,...E.map(t=>t-(t+A)))}return g&&this.put(m.toDataURL("image/png"),Object.assign(Object.assign({},t),{name:[t.name,"tuning"].join("-")})),{width:m.width,height:m.height,contWidth:y,contHeight:w,txtProp:x,fontStyle:p}}svgGenerate(t,e){let n="",{x:i,y:o}={x:(t.width-e.margin)/2-t.contWidth/2,y:(t.height-e.margin)/2-t.contHeight/2};const a=[e.rotateDegree,i+t.contWidth/2,o+t.contHeight/2].join(","),r=document.createElement("svg"),s=document.createElement("text");if(r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",`${t.width}`),r.setAttribute("height",`${t.height}`),r.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`),r.setAttribute("version","1.1"),s.innerText=e.content,s.style=["display: block","pointer-events: none",`font:${t.fontStyle}`,`fill:${e.fontColor}`,"block-size: min-content","text-anchor: start","text-align: center","transform-origin: top left",`dominant-baseline:${e.baseline}`,`alignment-baseline:${e.baseline}`].join("; "),s.setAttribute("x",`${i+t.txtProp.actualBoundingBoxLeft}`),s.setAttribute("y",`${o+t.txtProp.actualBoundingBoxAscent}`),s.setAttribute("transform",`rotate(${a})`),s.setAttribute("opacity",`${e.opacity}`),e.tuning){const n=document.createElement("rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("fill","rgba(0,255,0, 0.08)"),n.setAttribute("width",""+(t.width-e.margin)),n.setAttribute("height",""+(t.height-e.margin)),r.append(n),s.style.outline="1px dotted rgba(0, 0, 255, 0.25)";const l=document.createElement("rect");l.setAttribute("x",`${i}`),l.setAttribute("y",`${o}`),l.setAttribute("width",`${t.contWidth}`),l.setAttribute("height",`${t.contHeight}`),l.setAttribute("fill","rgba(255,255,0, 0.2)"),l.setAttribute("stroke","rgba(255,0,0, 0.25)"),l.setAttribute("transform",`rotate(${a})`),r.append(l);const c=document.createElement("circle");c.setAttribute("cx",`${i+t.contWidth/2}`),c.setAttribute("cy",`${o+t.contHeight/2}`),c.setAttribute("r","2.5"),c.setAttribute("fill","rgba(0,0,0, .5)"),r.append(c)}return r.append(s),n="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(r.outerHTML))),console.log("svgGenerate",r,t,n),n}put(t,e){var n;let i=null!==(n=e.name)&&void 0!==n?n:"",o=document.getElementById(i),a=null,r=e.carrierElem;console.warn("put",o),"cover"===e.mode?(a=null!=o?o:document.createElement("div"),a.id=i,a.style=[a.style.cssText,"pointer-events:none","position:absolute","top:0","left:0",`z-index:${e.zIndex}`,"width:100%","height:100%"].join("!important;")):a=r||document.body,a.style=[a.style.cssText,"-webkit-print-color-adjust:exact","print-color-adjust:exact","color-adjust:exact",`background-image:url(${t})`,`background-position:${e.position}`,`background-repeat:${e.repeat}`,`background-size:${e.size}`].join("!important;"),"cover"===e.mode&&(r.style.position="relative",o||r.append(a))}}});
//# sourceMappingURL=watermark.min.js.map
