!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WaterMark=e()}(this,function(){"use strict";function t(t,e,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(t):o?o.value:e.get(t)}var e,n;function o(t){const{content:e,fontWeight:n,fontSize:o,fontFamily:i,rotateDegree:r,margin:s,padding:c,opacity:l,needClip:d,tuning:u,degraded:h}=t,g=[n,o,i].join(" "),p=document.createElement("canvas"),m=p.getContext("2d");function f(t){return m.font=g,m.fillStyle="red",m.textAlign="start",m.textBaseline="top",m.measureText(t)}let b=null;b=h?function(t){const e=document.createElement("span");e.style.display="block",e.style.position="absolute",e.style.lineHeight="1",e.style.fontWeight=n,e.style.fontSize=o,e.style.fontFamily=i,e.innerText=t,e.style.visibility="hidden",document.body.appendChild(e);const a=window.getComputedStyle(e),r=JSON.parse(JSON.stringify({actualBoundingBoxAscent:0,actualBoundingBoxLeft:0,actualBoundingBoxDescent:parseFloat(a.height),actualBoundingBoxRight:parseFloat(a.width)}));return document.body.removeChild(e),r}(e):f(e);const x=b.actualBoundingBoxRight+b.actualBoundingBoxLeft,y=b.actualBoundingBoxDescent+b.actualBoundingBoxAscent,w=Math.sqrt(Math.pow(x/2,2)+Math.pow(y/2,2))+c,A=w-x/2,B=w-y/2,$=-w+A+b.actualBoundingBoxLeft,v=-w+B+b.actualBoundingBoxAscent,P=[[-x/2,-y/2],[x/2,-y/2],[x/2,y/2],[-x/2,y/2]],E=(null!=r?r:0)*Math.PI/180,k=P.map(t=>[t[0]*Math.cos(E)-t[1]*Math.sin(E),t[0]*Math.sin(E)+t[1]*Math.cos(E)]),M=[Math.min(...k.map(t=>t[0]))-c,Math.min(...k.map(t=>t[1]))-c],j=[Math.max(...k.map(t=>t[0]))+c,Math.max(...k.map(t=>t[1]))+c].map(t=>2*t);if(u&&(p.width=2*w+s,p.height=2*w+s,m.globalAlpha=l,m.translate(w,w),m.rotate(E),f(e),m.fillText(e,$,v),m.fillStyle="rgba(0,0,0,0.2)",m.beginPath(),m.strokeRect(-w+A,-w+B,x,y),m.closePath(),m.setLineDash([5,15]),m.beginPath(),m.moveTo(-w,0),m.lineTo(w,0),m.closePath(),m.stroke(),m.rotate(-E),m.setLineDash([]),m.beginPath(),m.arc(0,0,w-c,0,2*Math.PI),m.closePath(),m.stroke(),m.beginPath(),m.arc(0,0,w,0,2*Math.PI),m.closePath(),m.stroke(),k.forEach(t=>{m.fillStyle="red",m.beginPath(),m.arc(t[0],t[1],0,0,2*Math.PI),m.closePath(),m.fill()}),m.setLineDash([8,4]),m.beginPath(),m.strokeRect(...M,...j),m.closePath(),m.setLineDash([])),d){const t=m.getImageData(...M,...j.map(t=>t+w));p.width=j[0]+s,p.height=j[1]+s,m.putImageData(t,...M.map(t=>t-(t+w)))}return u&&a(p.toDataURL("image/png"),Object.assign(Object.assign({},t),{name:[t.name,"tuning"].join("-")})),{width:p.width,height:p.height,contWidth:x,contHeight:y,txtProp:b,fontStyle:g}}function i(t,e){let n="",{x:o,y:i}={x:(t.width-e.margin)/2-t.contWidth/2,y:(t.height-e.margin)/2-t.contHeight/2};const a=[e.rotateDegree,o+t.contWidth/2,i+t.contHeight/2].join(","),r=document.createElement("svg"),s=document.createElement("text");if(r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",`${t.width}`),r.setAttribute("height",`${t.height}`),r.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`),r.setAttribute("version","1.1"),s.innerText=e.content,s.style=["display: block","pointer-events: none",`font:${t.fontStyle}`,`fill:${e.fontColor}`,"block-size: min-content","text-anchor: start","text-align: center","transform-origin: top left",`dominant-baseline:${e.baseline}`,`alignment-baseline:${e.baseline}`].join("; "),s.setAttribute("x",`${o+t.txtProp.actualBoundingBoxLeft}`),s.setAttribute("y",`${i+t.txtProp.actualBoundingBoxAscent}`),s.setAttribute("transform",`rotate(${a})`),s.setAttribute("opacity",`${e.opacity}`),e.tuning){const n=document.createElement("rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("fill","rgba(0,255,0, 0.08)"),n.setAttribute("width",""+(t.width-e.margin)),n.setAttribute("height",""+(t.height-e.margin)),r.append(n),s.style.outline="1px dotted rgba(0, 0, 255, 0.25)";const c=document.createElement("rect");c.setAttribute("x",`${o}`),c.setAttribute("y",`${i}`),c.setAttribute("width",`${t.contWidth}`),c.setAttribute("height",`${t.contHeight}`),c.setAttribute("fill","rgba(255,255,0, 0.2)"),c.setAttribute("stroke","rgba(255,0,0, 0.25)"),c.setAttribute("transform",`rotate(${a})`),r.append(c);const l=document.createElement("circle");l.setAttribute("cx",`${o+t.contWidth/2}`),l.setAttribute("cy",`${i+t.contHeight/2}`),l.setAttribute("r","2.5"),l.setAttribute("fill","rgba(0,0,0, .5)"),r.append(l)}r.append(s);let c=null;if("undefined"==typeof TextEncoder){const t=encodeURIComponent(r.outerHTML).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(+("0x"+e))});c=window.btoa(t)}else{const t=(new TextEncoder).encode(r.outerHTML);c=window.btoa(String.fromCharCode(...t))}return n=`data:image/svg+xml;base64,${c}`,n}function a(t,e){var n;let o=null,i=e.carrierElem;"cover"===e.mode?(o=document.createElement("div"),o.className=null!==(n=e.name)&&void 0!==n?n:"",o.style=[o.style.cssText,"pointer-events:none","position:absolute","top:0","left:0",`z-index:${e.zIndex}`,"width:100%","height:100%"].join("!important;")):o=i||document.body,o.style=[o.style.cssText,"-webkit-print-color-adjust:exact","print-color-adjust:exact","color-adjust:exact",`background-image:url(${t})`,`background-position:${e.position}`,`background-repeat:${e.repeat}`,`background-size:${e.size}`].join("!important;"),"cover"===e.mode&&(i.style.position="relative",i.append(o))}"function"==typeof SuppressedError&&SuppressedError;return e=new WeakSet,n=function(t){return Object.assign(Object.assign({},this.options),t)},class{constructor(t){e.add(this),this.options={name:"2080code-watermark",mode:"mat",carrierElem:document.body,zIndex:1e5,content:"watermark",url:"",fontWeight:"normal",fontSize:"16px",fontFamily:"Hei",fontColor:"rgba(0,0,0,1)",baseline:"hanging",rotateDegree:0,size:"auto",margin:0,padding:0,position:"center center",repeat:"repeat",opacity:.1,needClip:!0,degraded:!1,tuning:!1},this.options=Object.assign(Object.assign({},this.options),t)}getDataURL(a){const r=t(this,e,"m",n).call(this,a);if(r.content){return i(o(r),r)}throw new Error("options.content is required")}draw(r){const s=t(this,e,"m",n).call(this,r);if(s.content){a(i(o(s),s),s)}else{if(!s.url)throw new Error("options.url or options.content is required");a(s.url,s)}}}});
//# sourceMappingURL=watermark.min.js.map
