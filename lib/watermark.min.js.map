{"version":3,"file":"watermark.min.js","sources":["../src/watermark.ts"],"sourcesContent":["import { WaterMarkOptions,SketchOptions } from './types'\r\n\r\n/**\r\n * 水印\r\n * 支持草图调试的水印生成工具\r\n * @param {Object} options 配置项\r\n * @param {String} options.name 水印的名称，会影响 cover 模式下水印层元素的 class 命名\r\n * @param {HTMLElement} options.carrierElem 水印层载体，默认在根元素（body）下\r\n * @param {Number} options.zIndex 水印层 z-index，默认 1000000\r\n * @param {String} options.mode mat|cover，放置模式，默认 mat（cover模式下为确保水印覆盖到，请检查载体宽高，mat 模式下水印的打印是非强制的，可能丢失）\r\n * @param {String} options.content 水印文字内容\r\n * @param {String} options.url 水印资源，与 content 互斥\r\n * @param {String} options.fontFamily 字体名\r\n * @param {String} options.fontWeight 字体粗细\r\n * @param {String} options.fontSize 字体大小\r\n * @param {String} options.fontColor 字体颜色\r\n * @param {String} options.baseline 文本基线设置（svg text alignment-baseline）\r\n * @param {Number} options.rotateDegree 旋转角度\r\n * @param {String} options.size 水印尺寸（css background-size）\r\n * @param {Number} options.margin 水印之间的外间距\r\n * @param {Number} options.padding 水印之间的内间距\r\n * @param {Boolean} options.needClip 是否裁切掉空白\r\n * @param {String} options.position 水印铺设位置（css background-position）\r\n * @param {String} options.repeat 水印铺设方式（css background-repeat）\r\n * @param {Number} options.opacity 透明度，同时影响水印及调试层\r\n * @param {Boolean} options.tuning 调试模式开关，设为 true 会在水印下添加 canvas 画布生成的参照底图，能够观察到 margin、padding、rotateDegree、baseline 等参数的设置效果，方便调试。只支持在 cover 模式下开启。\r\n * @param {Boolean} options.degraded 降级处理，更好的兼容性。canvas 的 measureText 本身具有对文字更精确的捕获，但因为兼容性问题，低版本浏览器对它的特性支持不完全，只得以 HTML DOM 的 getComputedStyle 取代 canvas measureText 来完成基础绘制和尺寸的捕获。\r\n * @example\r\n * // 基本使用\r\n * const waterMark=new WaterMark({\r\n *     text:'水印文字',\r\n * })\r\n * waterMark.draw()\r\n */\r\n\r\n\r\n/**\r\n * 生成水印草图，svg会据此生成水印\r\n * @param {WaterMarkOptions} options 配置项\r\n * @returns {SketchOptions} sketch 信息\r\n */\r\nfunction draft(options:WaterMarkOptions):SketchOptions{\r\n    const {\r\n        content,\r\n        fontWeight,\r\n        fontSize,\r\n        fontFamily,\r\n        rotateDegree,\r\n        margin,\r\n        padding,\r\n        opacity,\r\n        needClip,\r\n        tuning,\r\n        degraded,\r\n    }=options\r\n\r\n    const fontStyle=[fontWeight,fontSize,fontFamily].join(' ')\r\n    const canvas = document.createElement('canvas'); // 创建canvas元素\r\n    const ctx:CanvasRenderingContext2D=canvas.getContext('2d')!;\r\n\r\n    function setTxtProp(txt:string):TextMetrics{\r\n        ctx.font=fontStyle;\r\n        ctx.fillStyle = 'red';\r\n        ctx.textAlign='start';\r\n        ctx.textBaseline = 'top';\r\n        return ctx.measureText(txt);\r\n    }\r\n    function txtDom(txt:string){\r\n        // 为兼容老浏览器（如 chrome <= 75）\r\n        const dom=document.createElement('span')\r\n        dom.style.display='block';\r\n        dom.style.position='absolute';\r\n        dom.style.lineHeight='1'\r\n        dom.style.fontWeight=fontWeight\r\n        dom.style.fontSize=fontSize\r\n        dom.style.fontFamily=fontFamily\r\n        dom.innerText=txt\r\n        dom.style.visibility='hidden'\r\n        document.body.appendChild(dom)\r\n        const style=window.getComputedStyle(dom)\r\n        const size=JSON.parse(JSON.stringify({\r\n            actualBoundingBoxAscent:0,\r\n            actualBoundingBoxLeft:0,\r\n            actualBoundingBoxDescent:parseFloat(style.height),\r\n            actualBoundingBoxRight:parseFloat(style.width),\r\n        }))\r\n        document.body.removeChild(dom)\r\n        return size\r\n    }\r\n\r\n    let txtProp=null\r\n    if(degraded){\r\n        txtProp=txtDom(content!)\r\n    }else{\r\n        txtProp=setTxtProp(content!)\r\n    }\r\n    // console.log(txtProp)\r\n    // debugger\r\n    const contWidth=txtProp.actualBoundingBoxRight +txtProp.actualBoundingBoxLeft;\r\n    const contHeight=txtProp.actualBoundingBoxDescent +txtProp.actualBoundingBoxAscent;\r\n    const radius=Math.sqrt(Math.pow(contWidth/2,2)+Math.pow(contHeight/2,2)); //圆弧半径（依据文字中心点到最远距离，用勾股定理算出半径）\r\n    const maxRadius=radius+padding; // 带 padding 的半径\r\n    const contOffsetX=maxRadius-contWidth/2;\r\n    const contOffsetY=maxRadius-contHeight/2;\r\n    const txtX=-maxRadius+contOffsetX+txtProp.actualBoundingBoxLeft;\r\n    const txtY=-maxRadius+contOffsetY+txtProp.actualBoundingBoxAscent;\r\n    const originAxis=[\r\n        [-contWidth/2,-contHeight/2], // 上左\r\n        [contWidth/2,-contHeight/2], // 上右\r\n        [contWidth/2,contHeight/2], // 下右\r\n        [-contWidth/2,contHeight/2] // 下左\r\n    ];\r\n    const radian=(rotateDegree??0)*Math.PI/180; // 旋转角度\r\n    const newAxis=originAxis.map(axis=>{\r\n        // 获取旋转后的四点新坐标\r\n        return [\r\n            axis[0]*Math.cos(radian)-axis[1]*Math.sin(radian),\r\n            axis[0]*Math.sin(radian)+axis[1]*Math.cos(radian)\r\n        ]\r\n    });\r\n    const clipStartAxis:[number,number]=[\r\n        Math.min(...newAxis.map(axis=>axis[0]))-padding,\r\n        Math.min(...newAxis.map(axis=>axis[1]))-padding\r\n    ];\r\n    const clipSize=([\r\n        Math.max(...newAxis.map(axis=>axis[0]))+padding,\r\n        Math.max(...newAxis.map(axis=>axis[1]))+padding\r\n    ]).map(value=>value*2) as [number,number];\r\n\r\n\r\n    if(tuning){\r\n        // 绘制调试层\r\n        (function tuningLayer(){\r\n            canvas.width = maxRadius*2+margin;\r\n            canvas.height = maxRadius*2+margin;\r\n\r\n            ctx.globalAlpha=opacity;\r\n            ctx.translate(maxRadius,maxRadius); // 为旋转设置轴心\r\n            // 旋转\r\n            ctx.rotate(radian);\r\n\r\n            // text\r\n            // console.log('text',txtX,txtY)\r\n            setTxtProp(content!);\r\n            ctx.fillText(content!,txtX,txtY);\r\n\r\n            // 辅助绘制：\r\n            ctx.fillStyle = 'rgba(0,0,0,0.2)';\r\n            // 文字背景\r\n            ctx.beginPath();\r\n            ctx.strokeRect(-maxRadius+contOffsetX,-maxRadius+contOffsetY,contWidth,contHeight);\r\n            ctx.closePath();\r\n\r\n            // 水平线\r\n            ctx.setLineDash([5,15])\r\n            ctx.beginPath();\r\n            ctx.moveTo(-maxRadius, 0);\r\n            ctx.lineTo(maxRadius, 0);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n            \r\n            ctx.rotate(-radian);\r\n            ctx.setLineDash([])\r\n            \r\n            // 旋转轨道\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, maxRadius-padding, 0, Math.PI*2);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n            \r\n            // padding\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, maxRadius, 0, Math.PI*2);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n            \r\n            // 矩形区域坐标点\r\n            newAxis.forEach(axis=>{\r\n                ctx.fillStyle = 'red';\r\n                ctx.beginPath();\r\n                ctx.arc(axis[0], axis[1], 0, 0, Math.PI*2);\r\n                ctx.closePath();\r\n                ctx.fill();\r\n            })\r\n\r\n            // 标出裁切区域\r\n            ctx.beginPath();\r\n            ctx.strokeRect(...clipStartAxis,...clipSize);\r\n            ctx.closePath();\r\n        })();\r\n    }\r\n\r\n    if(needClip){\r\n        // clip\r\n        // console.log('newAxis',newAxis,clipStartAxis,clipSize)\r\n        const imgCopy=ctx.getImageData(...clipStartAxis,...clipSize.map(value=>value+maxRadius) as [number,number]);\r\n\r\n        canvas.width = clipSize[0]+margin;\r\n        canvas.height = clipSize[1]+margin;\r\n        ctx.putImageData(imgCopy,...clipStartAxis.map(value=>value-(value+maxRadius)) as [number,number]);\r\n    }\r\n\r\n    if(tuning){\r\n        put(canvas.toDataURL('image/png'),{\r\n            ...options,\r\n            name:[options.name,'tuning'].join('-')\r\n        })\r\n    }\r\n\r\n    return {\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        contWidth,\r\n        contHeight,\r\n        txtProp,\r\n        fontStyle\r\n    }\r\n}\r\n\r\n/**\r\n * 生成svg水印本体\r\n * @param {SketchOptions} sketch 水印草图参数\r\n * @returns String 水印base64 dataURL\r\n */\r\nfunction svgGenerate(sketch:SketchOptions,options:WaterMarkOptions){\r\n    let dataURL=''\r\n    let {x,y}={\r\n        x:(sketch.width-options.margin)/2-sketch.contWidth/2,\r\n        y:(sketch.height-options.margin)/2-sketch.contHeight/2\r\n    }\r\n    const rotateParams=[\r\n        options.rotateDegree,\r\n        x+sketch.contWidth/2,\r\n        y+sketch.contHeight/2\r\n    ].join(',')\r\n    const svg=document.createElement('svg')\r\n    const text=document.createElement('text')\r\n\r\n    // <svg>\r\n    svg.setAttribute('xmlns','http://www.w3.org/2000/svg')\r\n    svg.setAttribute('width',`${sketch.width}`)\r\n    svg.setAttribute('height',`${sketch.height}`)\r\n    svg.setAttribute('viewBox',`0 0 ${sketch.width} ${sketch.height}`)\r\n    svg.setAttribute('version','1.1')\r\n\r\n    // <text>\r\n    text.innerText=options.content\r\n    text.style=[\r\n        `display: block`,\r\n        `pointer-events: none`,\r\n        `font:${sketch.fontStyle}`,\r\n        `fill:${options.fontColor}`,\r\n        'block-size: min-content',\r\n        'text-anchor: start',\r\n        'text-align: center',\r\n\r\n        'transform-origin: top left',\r\n        `dominant-baseline:${options.baseline}`,\r\n        `alignment-baseline:${options.baseline}`,\r\n    ].join('; ');\r\n    text.setAttribute('x',`${x+sketch.txtProp.actualBoundingBoxLeft}`)\r\n    text.setAttribute('y',`${y+sketch.txtProp.actualBoundingBoxAscent}`)\r\n    text.setAttribute('transform',`rotate(${rotateParams})`)\r\n    text.setAttribute('opacity',`${options.opacity}`)\r\n\r\n    if(options.tuning){\r\n        \r\n        const boxRect=document.createElement('rect')\r\n        boxRect.setAttribute('x','0')\r\n        boxRect.setAttribute('y','0')\r\n        boxRect.setAttribute('fill','rgba(0,255,0, 0.08)')\r\n        boxRect.setAttribute('width',`${sketch.width-options.margin}`)\r\n        boxRect.setAttribute('height',`${sketch.height-options.margin}`)\r\n        svg.append(boxRect)\r\n        \r\n        text.style.outline='1px dotted rgba(0, 0, 255, 0.25)'\r\n        \r\n        const contRect=document.createElement('rect')\r\n        contRect.setAttribute('x',`${x}`)\r\n        contRect.setAttribute('y',`${y}`)\r\n        contRect.setAttribute('width',`${sketch.contWidth}`)\r\n        contRect.setAttribute('height',`${sketch.contHeight}`)\r\n        contRect.setAttribute('fill','rgba(255,255,0, 0.2)')\r\n        contRect.setAttribute('stroke','rgba(255,0,0, 0.25)')\r\n        contRect.setAttribute('transform',`rotate(${rotateParams})`)\r\n        svg.append(contRect)\r\n\r\n        const centralCircle=document.createElement('circle')\r\n        centralCircle.setAttribute('cx',`${x+sketch.contWidth/2}`)\r\n        centralCircle.setAttribute('cy',`${y+sketch.contHeight/2}`)\r\n        centralCircle.setAttribute('r','2.5')\r\n        centralCircle.setAttribute('fill','rgba(0,0,0, .5)')\r\n        svg.append(centralCircle)\r\n    }\r\n\r\n    svg.append(text)\r\n\r\n    const svgEncodeString=encodeURIComponent(svg.outerHTML).replace(/%([0-9A-F]{2})/g, function(match, p1) {\r\n        return String.fromCharCode(+('0x' + p1));\r\n    });\r\n    const base64=window.btoa(svgEncodeString)\r\n    \r\n    dataURL=`data:image/svg+xml;base64,${base64}`\r\n    // console.log('svgGenerate',sketch,svg,svgEncodeString,dataURL)\r\n    return dataURL\r\n}\r\n\r\n/**\r\n * 水印放置\r\n * @param {String} imgURL 水印内容，base64\r\n * @param {WaterMarkOptions} options 是否为调试模式\r\n */\r\nfunction put(imgURL:string,options:WaterMarkOptions){\r\n    let elemID=options.name??''\r\n    let existElem=document.getElementById(elemID)\r\n    let elem=null\r\n    let carrierElem=options.carrierElem;\r\n    // console.warn('put',existElem)\r\n\r\n    // 明确水印载体元素\r\n    if(options.mode==='cover'){\r\n        // 如果是cover模式，会新建一个层，用来装载水印\r\n        elem=existElem??document.createElement('div')\r\n        elem.id=elemID\r\n        // 并以相对位置设置水印层覆盖在目标上的基础样式\r\n        elem.style=[\r\n            elem.style.cssText,\r\n            'pointer-events:none',\r\n            'position:absolute',\r\n            'top:0',\r\n            'left:0',\r\n            `z-index:${options.zIndex}`,\r\n            'width:100%',\r\n            'height:100%'\r\n        ].join('!important;');\r\n    }else{\r\n        // 如果是mat，水印是直接装载到目标的background上的\r\n        elem=carrierElem||document.body\r\n    };\r\n\r\n    // 水印载体内容\r\n    elem.style=[\r\n        elem.style.cssText,\r\n        '-webkit-print-color-adjust:exact',\r\n        'print-color-adjust:exact',\r\n        'color-adjust:exact',\r\n        `background-image:url(${imgURL})`, // 水印内容\r\n        `background-position:${options.position}`,\r\n        `background-repeat:${options.repeat}`,\r\n        `background-size:${options.size}`\r\n        \r\n    ].join('!important;');\r\n    \r\n    // cover模式下将水印层置入目标元素中\r\n    if(options.mode==='cover'){\r\n        carrierElem.style.position='relative';\r\n        if(!existElem){\r\n            carrierElem.append(elem);\r\n        }\r\n    }else{\r\n\r\n    }\r\n}\r\n\r\nclass WaterMark{\r\n    constructor(options:WaterMarkOptions){\r\n        this.options={...this.options,...options}\r\n    }\r\n\r\n    options={\r\n        name:'2080code-watermark',\r\n        mode:'mat',\r\n        carrierElem:document.body,\r\n        zIndex:100000,\r\n        content:'watermark',\r\n        url:'',\r\n        fontWeight:'normal',\r\n        fontSize:'16px',\r\n        fontFamily:'Hei',\r\n        fontColor:'rgba(0,0,0,1)',\r\n        baseline:'hanging',\r\n        rotateDegree:0,\r\n        size:'auto',\r\n        margin:0,\r\n        padding:0,\r\n        position:'center center',\r\n        repeat:'repeat',\r\n        opacity:0.1,\r\n        needClip:true,\r\n        degraded:false,\r\n        tuning:false,\r\n    }\r\n\r\n    /**\r\n     * 绘制水印\r\n     * @param {WaterMarkOptions} options 配置项，覆盖实例\r\n     */\r\n    draw(options:WaterMarkOptions){\r\n        const finalOptions:WaterMarkOptions={\r\n            ...this.options,\r\n            ...options\r\n        }\r\n        \r\n        if(finalOptions.url){\r\n            put(finalOptions.url,finalOptions)\r\n        }else if(finalOptions.content){\r\n            const sketch=draft(finalOptions)\r\n            const svg=svgGenerate(sketch,finalOptions)\r\n            put(svg,finalOptions)\r\n        }else{\r\n            throw new Error('options.url or options.content is required')\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport default WaterMark\r\n"],"names":["put","imgURL","options","elemID","_a","name","existElem","document","getElementById","elem","carrierElem","mode","createElement","id","style","cssText","zIndex","join","body","position","repeat","size","append","constructor","this","content","url","fontWeight","fontSize","fontFamily","fontColor","baseline","rotateDegree","margin","padding","opacity","needClip","degraded","tuning","Object","assign","draw","finalOptions","Error","sketch","fontStyle","canvas","ctx","getContext","setTxtProp","txt","font","fillStyle","textAlign","textBaseline","measureText","txtProp","dom","display","lineHeight","innerText","visibility","appendChild","window","getComputedStyle","JSON","parse","stringify","actualBoundingBoxAscent","actualBoundingBoxLeft","actualBoundingBoxDescent","parseFloat","height","actualBoundingBoxRight","width","removeChild","txtDom","contWidth","contHeight","maxRadius","Math","sqrt","pow","contOffsetX","contOffsetY","txtX","txtY","originAxis","radian","PI","newAxis","map","axis","cos","sin","clipStartAxis","min","clipSize","max","value","globalAlpha","translate","rotate","fillText","beginPath","strokeRect","closePath","setLineDash","moveTo","lineTo","stroke","arc","forEach","fill","imgCopy","getImageData","putImageData","toDataURL","draft","svg","dataURL","x","y","rotateParams","text","setAttribute","boxRect","outline","contRect","centralCircle","svgEncodeString","encodeURIComponent","outerHTML","replace","match","p1","String","fromCharCode","btoa","svgGenerate"],"mappings":"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"}